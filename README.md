# ğŸ” EIP-712 ç­¾åå™¨

ä¸€ä¸ªå®‰å…¨çš„ EIP-712 ç­¾åå·¥å…·ï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œç§é’¥å®‰å…¨ä¿å­˜åœ¨åç«¯æœåŠ¡å™¨ä¸­ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ”’ **å®‰å…¨ç¬¬ä¸€**: ç§é’¥ä¿å­˜åœ¨åç«¯ç¯å¢ƒå˜é‡ä¸­ï¼Œä¸ä¼šæš´éœ²åˆ°å‰ç«¯
- ğŸ› ï¸ **é€šç”¨æ€§å¼º**: æ”¯æŒä»»æ„ EIP-712 ç»“æ„çš„ç­¾å
- ğŸ”§ **è‡ªåŠ¨ä¿®å¤**: è‡ªåŠ¨å¤„ç†å¸¸è§çš„ EIP-712 ç±»å‹é—®é¢˜
- ğŸŒ **å‰åç«¯åˆ†ç¦»**: æ¸…æ™°çš„ API æ¶æ„
- âœ… **ç­¾åéªŒè¯**: è‡ªåŠ¨éªŒè¯ç­¾åçš„æ­£ç¡®æ€§
- ğŸ“Š **è¯¦ç»†è¾“å‡º**: æä¾›ç­¾ååˆ†è§£å’Œè°ƒè¯•ä¿¡æ¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yourusername/eip712-signer.git
cd eip712-signer
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
cp env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ç§é’¥
nano .env
```

åœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½®ï¼š

```env
PRIVATE_KEY=0xä½ çš„ç§é’¥
PORT=3000
HOST=localhost
```

### 4. å¯åŠ¨æœåŠ¡å™¨

```bash
# ç”Ÿäº§ç¯å¢ƒ
npm start

# å¼€å‘ç¯å¢ƒï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm run dev
```

### 5. ä½¿ç”¨å‰ç«¯ç•Œé¢

æ‰“å¼€ `frontend.html` æ–‡ä»¶ï¼Œæˆ–è€…åœ¨æµè§ˆå™¨ä¸­è®¿é—®æœåŠ¡å™¨æä¾›çš„å‰ç«¯é¡µé¢ã€‚

## ğŸ“– API æ–‡æ¡£

### POST /api/sign

ç­¾å EIP-712 æ•°æ®

**è¯·æ±‚ä½“ï¼š**

```json
{
  "domain": {
    "name": "AuthTransfer",
    "chainId": 1,
    "verifyingContract": "0x40aA958dd87FC8305b97f2BA922CDdCa374bcD7f"
  },
  "message": {
    "details": [{
      "token": "0x0000000000000000000000000000000000000000",
      "expiration": 3242342
    }],
    "spenders": ["0xF3dE3C0d654FDa23daD170f0f320a92172509127"],
    "nonce": 1750070899677
  },
  "primaryType": "Permits",
  "types": {
    "Permits": [
      {"name": "details", "type": "PermitDetails[]"},
      {"name": "spenders", "type": "address[]"},
      {"name": "nonce", "type": "uint256"}
    ],
    "PermitDetails": [
      {"name": "token", "type": "address"},
      {"name": "expiration", "type": "uint256"}
    ]
  }
}
```

**å“åº”ï¼š**

```json
{
  "success": true,
  "signature": "0x1a3e5a7a5532c2e0e5c56e5cfecceca23c352575f3292ccdf8af4253156fc383...",
  "signerAddress": "0xFCAd0B19bB29D4674531d6f115237E16AfCE377c",
  "recoveredAddress": "0xFCAd0B19bB29D4674531d6f115237E16AfCE377c",
  "isValid": true,
  "primaryType": "Permits",
  "signatureBreakdown": {
    "r": "0x1a3e5a7a5532c2e0e5c56e5cfecceca23c352575f3292ccdf8af4253156fc3837",
    "s": "0x9517195e01af23955aba3d59d7919e9318092421f40496f427d3cf922952829",
    "v": 28,
    "recoveryParam": 1
  },
  "timestamp": "2023-12-16T10:30:00.000Z"
}
```

### GET /api/health

å¥åº·æ£€æŸ¥

**å“åº”ï¼š**

```json
{
  "status": "ok",
  "service": "EIP-712 ç­¾åæœåŠ¡",
  "timestamp": "2023-12-16T10:30:00.000Z",
  "version": "1.0.0"
}
```

### GET /api/address

è·å–ç­¾ååœ°å€

**å“åº”ï¼š**

```json
{
  "address": "0xFCAd0B19bB29D4674531d6f115237E16AfCE377c",
  "timestamp": "2023-12-16T10:30:00.000Z"
}
```

## ğŸ”§ å¸¸è§é—®é¢˜ä¿®å¤

### EIP712Domain é”™è¯¯

å¦‚æœé‡åˆ° "ambiguous primary types" é”™è¯¯ï¼Œæœ¬å·¥å…·ä¼šè‡ªåŠ¨ï¼š

1. ç§»é™¤ `types` ä¸­çš„ `EIP712Domain` å®šä¹‰
2. è‡ªåŠ¨æ¨æ–­ `primaryType`
3. æ¸…ç†å†²çªçš„ç±»å‹å®šä¹‰

### æ”¯æŒçš„ EIP-712 ç»“æ„

- âœ… æ ‡å‡† EIP-712 æ¶ˆæ¯
- âœ… åµŒå¥—ç±»å‹ç»“æ„
- âœ… æ•°ç»„ç±»å‹
- âœ… è‡ªå®šä¹‰ domain
- âœ… è‡ªåŠ¨ç±»å‹æ¨æ–­

## ğŸ›¡ï¸ å®‰å…¨è¯´æ˜

1. **ç§é’¥å®‰å…¨**: ç§é’¥åªä¿å­˜åœ¨æœåŠ¡å™¨ç¯å¢ƒå˜é‡ä¸­
2. **ç¯å¢ƒéš”ç¦»**: `.env` æ–‡ä»¶è¢« Git å¿½ç•¥
3. **CORS é…ç½®**: ç”Ÿäº§ç¯å¢ƒè¯·é…ç½®é€‚å½“çš„ CORS ç­–ç•¥
4. **HTTPS**: ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ HTTPS

## ğŸ“ é¡¹ç›®ç»“æ„

```
eip712-signer/
â”œâ”€â”€ server.js              # åç«¯ API æœåŠ¡å™¨
â”œâ”€â”€ frontend.html           # å‰ç«¯ç•Œé¢
â”œâ”€â”€ package.json           # é¡¹ç›®é…ç½®
â”œâ”€â”€ .gitignore            # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ env.example           # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ README.md             # é¡¹ç›®æ–‡æ¡£
```

## ğŸ”¨ å¼€å‘

### å®‰è£…å¼€å‘ä¾èµ–

```bash
npm install --save-dev nodemon
```

### è¿è¡Œå¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

## ğŸ“ ç¯å¢ƒå˜é‡

| å˜é‡å | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `PRIVATE_KEY` | âœ… | - | ç­¾åç§é’¥ |
| `PORT` | âŒ | 3000 | æœåŠ¡å™¨ç«¯å£ |
| `HOST` | âŒ | localhost | æœåŠ¡å™¨åœ°å€ |

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

## âš ï¸ å…è´£å£°æ˜

æœ¬å·¥å…·ä»…ä¾›å­¦ä¹ å’Œæµ‹è¯•ç”¨é€”ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ—¶ï¼Œè¯·ç¡®ä¿ï¼š

1. ç§é’¥å®‰å…¨ç®¡ç†
2. é€‚å½“çš„ç½‘ç»œå®‰å…¨é…ç½®
3. å®šæœŸå®‰å…¨å®¡è®¡
4. éµå¾ªæœ€ä½³å®‰å…¨å®è·µ

**ä½¿ç”¨æœ¬å·¥å…·çš„é£é™©ç”±ç”¨æˆ·è‡ªè¡Œæ‰¿æ‹…ã€‚** 